<!doctype html>
<html lang="en" ng-app="todomvc" scroll data-framework="firebase">
<head>
    <meta charset="utf-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- http://stackoverflow.com/questions/1341089/using-meta-tags-to-turn-off-caching-in-all-browsers -->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <!-- for Facebook sharing -->
    <meta property="og:url"                content="https://comp3111-qroom.firebaseapp.com/" />
    <meta property="og:type"               content="html" />
    <meta property="og:title"              content="Questions Room" />
    <meta property="og:description"        content="How much does culture influence creative thinking?" />
    <meta property="og:image"              content="http://static01.nyt.com/images/2015/02/19/arts/international/19iht-btnumbers19A/19iht-btnumbers19A-facebookJumbo-v2.jpg" />

    <title>Question Room: {{roomId}}</title>

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <!-- angular smilies -->
    <link rel="stylesheet" href="plugins/emoji/dist/angular-smilies-embed.min.css">

    <!-- need this for comlted ones. TODO: can I do this in bootstrap -->
    <link rel="stylesheet" href="css/main.css">


</head>
<body ng-controller="TodoCtrl">

    <!-- Facebook -->
    <div id="fb-root"></div>
    <script type="text/javascript" src="https://connect.facebook.net/en_US/sdk.js">
    window.fbAsyncInit = function() {
        FB.init({
            appId      : '1074795829199506',
            xfbml      : true,
            version    : 'v2.5'
        });
    };

    (function(d, s, id){
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) {return;}
        js = d.createElement(s); js.id = id;
        //js.src = "https://connect.facebook.net/en_US/sdk.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
    </script>
    <!-- END -->

    <div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/" 
                 data-layout="standard" 
                data-action="like" 
                data-show-faces="true" 
                data-share="true">
      </div>


    <div class="container">
        <div class="input-group pull-right">
            <a class="btn btn-default" href="./index.html">Main</a>
        </div>

        <!-- <div class="clearfix"></div>         -->
        <div class="page-header">
            <h1>Questions for {{roomId}}?</h1>
            <!--small>Share room url: {{absurl}}</small-->
        </div>

        <div class="well well-sm" id="question_box">
            <!-- tab navigation bar -->
            <ul class="nav nav-pills" id="tabs">
                <li class="active"><a data-toggle="tab" href="#tab_post"><i class="fa fa-commenting"></i> Post</a></li>
                <li><a data-toggle="tab" href="#tab_search"><i class="fa fa-search"></i> Search</a></li>
            </ul>

            <!-- tab content -->
            <div class="tab-content">
                <div id="tab_post" class="tab-pane fade in active">
                    <form name="todoForm" id="todoForm" ng-submit="addTodo()" ng-init="input.wholeMsg=''">
                        <div class="input-group">
                            <span class="input-group-addon" smilies-selector="input.wholeMsg" smilies-placement="bottom" smilies-title="Smilies"></span>
                            <input type="text" id="new-todo" name="new-todo" class="form-control ng-valid ng-touched ng-dirty ng-valid-parse" focus-on-change="input.wholeMsg" placeholder="Post Question at least 5 letters" ng-model="input.wholeMsg" style="height:50px" autofocus required/>
                            <div class="input-group-btn">
                                <button id="btn_post" class="btn btn-default" type="submit" ng-disabled="filterWord(input.wholeMsg)||input.wholeMsg.length < 5" ng-click="submitted = todoForm.$invalid"><i class="fa fa-commenting fa-lg"></i></button>
                            </div>
                        </div><!-- /input-group -->
                        <!-- collapsable list -->
                        <div id="collapse_list" class="panel-collapse collapse">
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <!-- input email address -->
                                    <label class="glyphicon glyphicon-envelope"> Email:</label>
                                    <div ng-init="input.email=''">
                                        <input type="email" name="input" class="form-control" ng-model="input.email" autofocus>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </form>
                    <div class="pull-left">
                        <span ng-style="{visibility: (postTimeCounter>0) && 'visible' || 'hidden'}"><small>Please wait for {{postTimeCounter}}    second to post again...</small></span>
                    </div>
                    <div class="pull-right">
                        <a id="toggle_advanced" data-toggle="collapse" href="#collapse_list"><span class="glyphicon glyphicon-collapse-down"></span> Show advanced options</a>
                    </div>
                    <div class="clearfix"></div>
                </div><!-- /#tab_post -->

                <div id="tab_search" class="tab-pane fade">
                    <div class="input-group">
                        <input type="text" id="new-search" class="form-control"    placeholder="Search Question"    ng-model="input.searchMsg" />
                        <div class="input-group-btn">
                            <button id="btn_reset" class="btn btn-danger" ng-click="input.wholeMsg='';input.email='';input.searchMsg='';input.searchMail=''">Reset <i class="fa fa-commenting fa-lg"></i></button>
                        </div>
                    </div><!-- /input-group -->
                    <label>Email:</label>
                    <div ng-init="input.searchMail=''">
                        <input type="email" name="input" class="form-control" placeholder="Search by mail" ng-model="input.searchMail" />
                    </div>
                </div>
            </div>
        </div><!-- /.well -->

        <!-- Error messages -->
        <div class="alert alert-danger fade in" role="alert" ng-show="input.wholeMsg.length < 5 && input.wholeMsg.length > 0"><strong>Error!</strong> Your question must be longer than 5 characters!&times;</div>
        <div class="alert alert-danger fade in" role="alert" ng-show="todoForm.$error.required && submitted"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> Your question cannot be empty! </div>
        <div class="alert alert-danger fade in" role="alert" ng-show="todoForm.$error.email"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> Invalid email! </div>
        <div class="alert alert-danger fade in" role="alert" ng-show="filterWord(input.wholeMsg)"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> No foul word! </div>

        <hr>

        <div class="list-group" id="todo-list" >
            <span class="list-group-item" ng-repeat="todo in todos | filter:input.searchMsg | filter:input.searchMail:true |questionFilter:maxQuestion" ng-class="{completed: todo.completed, editing: todo == editedTodo}" ng-hide="todo.echo < -15">
                <h4 class="list-group-item-heading" ng-switch on="todo.headLastChar">
                    <span class="label label-danger" ng-show="todo.new">New</span>
                    <span class="badge">{{todo.echo}}</span>
                    <!-- switch -->
                    <span ng-switch-when="?glyphicon glyphicon-envelope" class="glyphicon glyphicon-question-sign"></span>
                    <span ng-switch-when="!" class="glyphicon glyphicon-info-sign"></span>
                    <span ng-class="{completed: todo.completed}" ng-bind-html="todo.head | smilies">{{}}</span>
                </h4>
                <!-- use $sce.trustAsHtml to show trused html code, use ng-bind to show escaped html -->
                <!-- Now the code is santized : Sanitizes an html string by stripping all potentially dangerous tokens; only keep <b><i>etc. To be tested -->
                <p class="list-group-item-text"><span ng-bind-html="todo.trustedDesc | smilies"></span></p>
                <br>
                <p>created: {{timeAgo(todo.time)}}<span id="tag-label" class="label label-info" ng-show="todo.tags">{{todo.tags}}</span></p>

                <div id="likeContainer">
                    <button type="button" ng-class="{'btn btn-success': $storage[todo.$id]=='echoed', 'btn btn-default': $storage[todo.$id]!='echoed'}" ng-click="addEcho(todo)">Like
                    </button>
                    &nbsp;
                    <button type="button" ng-class="{'btn btn-danger': $storage[todo.$id]=='d_echoed', 'btn btn-default': $storage[todo.$id]!='d_echoed'}" ng-click="subEcho(todo)">Dislike
                    </button>
                    &nbsp;
                    <button type="button" class="btn btn-default">
                        <span class="glyphicon glyphicon-send" aria-hidden="true"></span> Reply
                    </button>
                    &nbsp;
                    <a href="https://www.facebook.com/sharer/sharer.php?u=example.org" target="_blank"><img src="fb.png"/></a>
                    <!-- after entering the correct email, editing is available -->
                    <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Manage your post
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="glyphicon glyphicon-pencil" ng-click="editTodo(todo)"> Edit</a></li>
                            <li><a class="glyphicon glyphicon-trash" ng-click="removeTodo(todo)"> Delete</a></li>
                        </ul>
                    </div>
                </div>
                
        </div>    

<!-- jquery -->
<script src="js/lib/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="js/lib/bootstrap.min.js"></script>

<!-- Autolink from https://github.com/gregjacobs/Autolinker.js> -->
<script src="js/lib/Autolinker.min.js"></script>

<!-- Angular -->
<script src="js/lib/angular.min.js"></script>
<script src="js/lib/angular-sanitize.min.js"></script>

<!-- Ng storage 0.3.6  -->
<script src="js/lib/ngStorage.min.js"></script>

<!-- Firebase -->
<script src="js/lib/firebase.js"></script>
<script src="js/lib/angularfire.min.js"></script>

<script src="js/main.js"></script>
<script src="js/app.js"></script>
<script src="js/filters/questionFilter.js"></script>
<script src="js/controllers/todoCtrl.js"></script>
<script src="js/directives/todoFocus.js"></script>
<script src="js/directives/todoBlur.js"></script>
<script src="js/directives/todoEscape.js"></script>

<!-- UI bootstrap (angular)-->
<script src="js/lib/ui-bootstrap-tpls-0.14.3.min.js"></script>

<!-- angular smilies -->
<script src="plugins/emoji/dist/angular-smilies.js"></script>

</body>
</html>
