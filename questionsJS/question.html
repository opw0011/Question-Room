<!doctype html>
<html lang="en" ng-app="todomvc" scroll data-framework="firebase">
<head>
	<meta charset="utf-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- http://stackoverflow.com/questions/1341089/using-meta-tags-to-turn-off-caching-in-all-browsers -->
	<meta http-equiv="cache-control" content="max-age=0" />
	<meta http-equiv="cache-control" content="no-cache" />
	<meta http-equiv="expires" content="0" />
	<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
	<meta http-equiv="pragma" content="no-cache" />

	<title>Question Room: {{roomId}}</title>

	<link rel="shortcut icon" href="favicon.ico">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">


	<!-- need this for comlted ones. TODO: can I do this in bootstrap -->
	<link rel="stylesheet" href="css/main.css">

</head>
<body ng-controller="TodoCtrl">

	<div class="container">
		<div class="input-group pull-right">
			<a class="btn btn-default" href="./index.html">Main</a>
			<button ng-hide="$authData" class="btn btn-primary left" type="button" ng-click="FBLogin()">Want Admin? Sign in with Facebook</button>
		</div>
		<!-- <div class="clearfix"></div>		 -->
		<div class="page-header">
			<h1>Questions for {{roomId}}?</h1>
			<small>Share room url: {{absurl}}</small>
		</div>

		<!-- after login -->
		<img ng-show="$authData" src="https://graph.facebook.com/{{$authData.facebook.id}}/picture/?type=square&return_ssl_resources=1" alt="{{name}}" />
		{{$authData.facebook.displayName}}
		<button ng-show="$authData" class="btn btn-primary left" type="button" ng-click="FBLogout()">Logout</button>

		<div class="well well-sm" id="question_box">
			<!-- tab navigation bar -->
			<ul class="nav nav-pills" id="tabs">
				<li class="active"><a data-toggle="tab" href="#tab_post"><i class="fa fa-commenting"></i> Post</a></li>
				<li><a data-toggle="tab" href="#tab_search"><i class="fa fa-search"></i> Search</a></li>
			</ul>

			<!-- tab content -->
			<div class="tab-content">
				<div id="tab_post" class="tab-pane fade in active">
					<form name="todoForm" id="todoForm" ng-submit="addTodo()">
						<div class="input-group">
							<!-- <input type="text" class="form-control"	placeholder="Search Question"	ng-model="input.searchMsg" /> -->
							<input type="text" id="new-todo" name="new-todo" class="form-control"	placeholder="Post Question"	ng-model="input.wholeMsg" autofocus required minlength="5"/>
							<!-- <span class="warning" ng-show="filterWord(input.wholeMsg)">No foul words!</span> -->
							<div class="input-group-btn">
								<button id="btn_post" class="btn btn-default" type="submit" ng-disabled="filterWord(input.wholeMsg)" ng-click="submitted = todoForm.$invalid"><i class="fa fa-commenting fa-lg"></i></button>
							</div>
						</div><!-- /input-group -->
						<!-- collapsable list -->
						<div id="collapse_list" class="panel-collapse collapse">
							<ul class="list-group">
								<li class="list-group-item">
									<!-- input email address -->
									<label>Email:</label>
									<div ng-init="input.email=''">
										<input type="email" name="input" class="form-control" ng-model="input.email" autofocus>
									</div>
								</li>
							</ul>
						</div>
					</form>
					<div class="pull-left">
						<span ng-style="{visibility: (postTimeCounter>0) && 'visible' || 'hidden'}"><small>Please wait for {{postTimeCounter}}	second to post again...</small></span>
					</div>
					<div class="pull-right">
						<a id="toggle_advanced" data-toggle="collapse" href="#collapse_list"><span class="glyphicon glyphicon-collapse-down"></span> Show advanced options</a>
					</div>
					<div class="clearfix"></div>
				</div><!-- /#tab_post -->

				<div id="tab_search" class="tab-pane fade">
					<div class="input-group">
						<input type="text" id="new-search" class="form-control"	placeholder="Search Question"	ng-model="input.searchMsg" />
						<div class="input-group-btn">
							<button id="btn_reset" class="btn btn-danger" ng-click="input.searchMsg='';input.searchMail=''">Reset <i class="fa fa-commenting fa-lg"></i></button>
						</div>
					</div><!-- /input-group -->
					<label>Email:</label>
					<div ng-init="input.searchMail=''">
						<input type="email" name="input" class="form-control" placeholder="Search by mail" ng-model="input.searchMail" />
					</div>
				</div>
			</div>
		</div><!-- /.well -->

		<!-- Error messages -->
		<div class="alert alert-danger fade in" role="alert" ng-show="todoForm.$error.minlength && submitted"><strong>Error!</strong> Your question must be longer than 5 characters! <a class="close" data-dismiss="alert" ng-click="submitted = false">&times;</a></div>
		<div class="alert alert-danger fade in" role="alert" ng-show="todoForm.$error.required && submitted"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> Your question cannot be empty! </div>
		<div class="alert alert-danger fade in" role="alert" ng-show="todoForm.$error.email && submitted"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> Invalid email! </div>
		<div class="alert alert-danger fade in" role="alert" ng-show="filterWord(input.wholeMsg)"><a class="close" data-dismiss="alert" aria-label="close" ng-click="submitted = false">&times;</a> <strong>Error!</strong> No foul word! </div>

		<hr>

		<div class="list-group" id="todo-list" >
			<span class="list-group-item" ng-repeat="todo in todos | filter:input.searchMsg | filter:input.searchMail:true |questionFilter:maxQuestion" ng-class="{completed: todo.completed, editing: todo == editedTodo}" ng-hide="todo.echo < -15">
				<h4 class="list-group-item-heading" ng-switch on="todo.headLastChar">
					<span class="label label-danger" ng-show="todo.new">New</span>
					<span class="badge">{{todo.echo}}</span>
					<!-- switch -->
					<span ng-switch-when="?" class="glyphicon glyphicon-question-sign"></span>
					<span ng-switch-when="!" class="glyphicon glyphicon-ice-lolly"></span>
					<span ng-class="{completed: todo.completed}">{{todo.head}}</span>
				</h4>
				<!-- use $sce.trustAsHtml to show trused html code, use ng-bind to show escaped html -->
				<!-- Now the code is santized : Sanitizes an html string by stripping all potentially dangerous tokens; only keep <b><i>etc. To be tested -->
				<p class="list-group-item-text"><span ng-bind-html="todo.trustedDesc"></span></p>
				<p>created: {{todo.dateString}} <span ng-show="todo.tags">tags: {{todo.tags}}</span></p>

				<button class="btn btn-default btn-xs glyphicon glyphicon-hand-up" ng-click="addEcho(todo)" ng-disabled="$storage[todo.$id]">Like</button>
				<button class="btn btn-default btn-xs glyphicon glyphicon-hand-down" ng-click="subEcho(todo)" ng-disabled="!$storage[todo.$id]">Dislike</button>
				<button ng-show="isAdmin" class="btn btn-default btn-xs glyphicon glyphicon-check" ng-click="toggleCompleted(todo)">Toggle Completed</button>
				&nbsp;
				<button ng-show="isAdmin" class="btn btn-default btn-xs glyphicon glyphicon-trash" aria-hidden="true" ng-click="removeTodo(todo)">Del</button>
			</span>
		</div>
	</div>

	<!--

	<div id="toTop" class="btn btn-info"><span class="fa fa-arrow-up">Back to Top</span></div>

	<button ng-hide="totalCount<=maxQuestion"
	class="pull-right btn btn-default glyphicon glyphicon-arrow-down"
	type="button" ng-click="increaseMax()"> Show more</button>
-->

<!-- jquery -->
<script src="js/lib/jquery.min.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="js/lib/bootstrap.min.js"></script>


<!-- Autolink from https://github.com/gregjacobs/Autolinker.js> -->
<script src="js/lib/Autolinker.min.js"></script>

<!-- 2.2.2 -->
<script src="js/lib/firebase.js"></script>
<script src="js/lib/angular.min.js"></script>
<script src="js/lib/angularfire.js"></script>
<script src="js/lib/angular-sanitize.js"></script>

<!-- Ng storage 0.3.6  -->
<script src="js/lib/ngStorage.min.js"></script>

<script src="js/app.js"></script>
<script src="js/filters/questionFilter.js"></script>
<script src="js/controllers/todoCtrl.js"></script>
<script src="js/directives/todoFocus.js"></script>
<script src="js/directives/todoBlur.js"></script>
<script src="js/directives/todoEscape.js"></script>

</body>
</html>
